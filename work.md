
# work文件格式说明： 

work文件格式是我自己定义的，以方便我不断修订书籍。我自己编写了程序，能从work文件格式的文件生成PDF、EPUB文件和HTML网页。

我的程序使用python，源代码在：https://gitlab.com/yulei.history/historyprog

## 标题： 

```
{# 一级标题} 
{## 二级标题} 
{## 显示于目录中的二级标题|显示于文本中的二级标题} 
{## |同时显示于文本和目录中的二级标题}
{## 只在于目录中显示在实际文本中不会显示的二级标题} 
```
注意，一级标题用作章的区分，一个一级标题，就是添加新的一章 

## 表格
```
|a|b|c|
|d|e|f|
```

## 上标和下标(与MD格式相同)
```
2^10^
H~2~O
```

## 数学公式
可以使用asciimath格式，参见：http://asciimath.org/ ，嵌入时不使用\`...\`，而是使用以下{% ... }的格式

```
{% x=(-b +- sqrt(b^2 – 4ac)) / (2a)}
```

也可以使用LaTeX格式，但是嵌入时不使用\\\[...\\\] 也不使用\\\(...\\\)或\$\$ ... \$\$，而是使用以下{%t ...}的格式

```
{%t x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}}
```

## 引用：
```
> 引用文字 
```

## 脚注： 
```
{^ 脚注文本} 
```

## 超连接
```
{* https://www.google.com}
{* https://www.google.com|谷歌}
```

## 隐藏文字

{文字内容被隐藏，虽然出现在work文件中，但不会出现在生成的HTML和PDF文件中}

## 换页（仅适用于生成PDF用）
{pagegreak}


## 文档属性:
```
{$ Title=文档标题}
{$ Version=文档版本}
```
目前只支持这几个属性，应该放在文档最前

## 译名:
一个重音符号开始一个需要翻译的中文名，之后的[]内，分号前的部分为英文译名

```
`中国[China]
`乔布斯[Steven Paul Jobs;1955-2011]
```

也可以如增加附加的中文信息以分辨，必须使用括号

```
`底比斯[(埃及城市)Thebes]
```

程序会收集文章中所有的这类译名文字，如果出现相同的中文对应不同的英文，程序会报警。

在正常页面中，重音符号`不会显示，其他的文字则如常显示。

如果需要生成译名对照表，参见下面的 译名对照表的说明

若出现以下情况，也即，[]之前没有`，则程序会报错

```
中国[China]
```

遇到这样的情况，应该写作两个中括号[[，程序会在输出的文本中，将两个中括号替换为一个，这种情况表明不用加入译名表

```
中国[[China]
```

大批量加入译名可以采用以下方法：从{`到}的全部文字。只作采集译名用，不会显示出来。

```
{`
`阿波罗[Apollo]
`阿布辛拜勒[Abu Simbel]
`阿阇世[Ajatashatru]
`阿尔泰语系[Altaic languages]
}
```

## 插图和地图： 
```
{! 插图ID|图片标题|副标题|来源|来源URL|扩展选项1|扩展选项2}
{& 地图ID|地图标题|副标题|来源|来源URL|扩展选项1|扩展选项2}
```
扩展选项1用于生成PDF页面时，扩展选项2用于生成HTML文件时

扩展选项可以设置成一个数字，或者以r开头后面跟着一个数字，r代表要逆时针旋转90度，数字代表图片在页面上设置的宽度

比如  扩展选项:"r400|600" 。表示生成PDF时，图片旋转宽度设置为400（旋转时宽度是原来图片的高度），生成HTML页面时，图片宽度设置成600


## 音乐引用

{m 音乐标题|说明;URL|说明;URL}

以|分隔，最前的是音乐的标题，第二个开始以分号分隔，分号前是说明，分号后是引用音乐的URL，使用这种方式，无论在HTML和PDF文件中，会出现音符+数字的标志，以标识这里引用了音乐，点击后HTML会弹出小窗口显示所有的引用，点击引用后，会弹出新的网页转到引用的URL上。如果是PDF，点击后会跳转到最后的音乐目录对应的音乐引用处。


## 标签方式

文本正文中插入脚注、地图、插图和音乐引用，会明显影响work文件的文字连贯，为此引入“标签方式”

### 定义标签

{^^标签 脚注文本}

{mm标签 音乐标题|说明;URL|说明;URL}

{!!标签 插图ID|图片标题|副标题|来源|来源URL|扩展选项1|扩展选项2}

{&&标签 地图ID|地图标题|副标题|来源|来源URL|扩展选项1|扩展选项2}

‘标签’可以是任意不包含空格的文本，通常以简略的数字。以上四种，分别定义了脚注、音乐引用、插图和地图。注意，实际使用标签时一定要之前出现过这个定义，所以方便的办法是在work文件开始处就列出全部标签定义。

### 使用标签

{^标签}

{m标签}

{!标签}

{&标签}

在正文文本中，插入以上内容，则使用已经定义过和标签，这样要比插入一长段内容对正文的影响小得多。

另外注意，音乐标签可以重复使用，而脚注、插图和地图则不行。且标签的定义是不能跨章的，也即一个章中定义的标签，在其他章中无法使用。

##  特殊章节

特殊章节，以{#! xxxxx}为标题。与普通章节不一样之处在于，不会加上章的编号，不会在前面加上第几章的字样，特殊章节通常用于插图、地图、音乐的目录以及中英文译名对照表

{#& xxxxx}为标题。与普通章节不一样之处在于，不会在章节的文本开头处生成小目录，通常用于序言

## 插图、地图、音乐的目录

{list image}  生成一个插图目录

{list map}  生成一个地图目录

{list music}  生成一个音乐目录

## 译名对照表

{translation}  生成一个中英文译名对照表
